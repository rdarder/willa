{"version":3,"file":"motor.js","sourceRoot":"","sources":["../src/motor.ts"],"names":[],"mappings":"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","sourcesContent":["import { LitElement, TemplateResult, css, html } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { solidColors, translucentColors, transparentColors } from './styles';\n\nexport enum MotorMode {\n  idle = 'idle',\n  brake = 'brake',\n  forward = 'forward',\n  reverse = 'reverse',\n}\n\nexport interface Active {\n  mode: MotorMode.forward | MotorMode.reverse;\n  power: number;\n}\nexport interface Idle {\n  mode: MotorMode.idle;\n  power: 0;\n}\nexport interface Break {\n  mode: MotorMode.brake;\n  power: 0;\n}\n\nexport type MotorControl = Active | Idle | Break;\n\ninterface BreakTouchArea {\n  zone: MotorMode.brake;\n}\ninterface ActiveTouchArea {\n  zone: MotorMode.forward | MotorMode.reverse;\n  power: number;\n}\ninterface UnknownTouchArea {\n  zone: MotorMode.idle;\n}\ntype PowerArea = BreakTouchArea | ActiveTouchArea | UnknownTouchArea;\n\n@customElement('drive-motor')\nexport class DriveMotor extends LitElement {\n  readonly BREAK_AREA = 0.2;\n  readonly CANVAS_PIXELS = 300;\n  @state()\n  private canvasWidth: number = 0;\n  @state()\n  private canvasHeight: number = 0;\n\n  @property({ type: Object })\n  current: MotorControl = { mode: MotorMode.idle, power: 0 };\n\n  firstUpdated(): void {\n    this.adjustCanvasSize();\n    window.addEventListener('resize', this.adjustCanvasSize.bind(this));\n  }\n\n  private adjustCanvasSize(): void {\n    const container = this.shadowRoot!.getElementById('canvas-container')!;\n    const rect = container.getBoundingClientRect();\n    this.canvasWidth = Math.floor(rect.width);\n    this.canvasHeight = Math.floor(rect.height);\n    const canvas = this.shadowRoot!.getElementById(\n      'canvas'\n    ) as HTMLCanvasElement;\n    canvas!.width = this.canvasWidth;\n    canvas!.height = this.canvasHeight;\n    this.requestUpdate();\n    this.updateCanvas();\n  }\n\n  getTouchArea = (event: TouchEvent, current: MotorMode): PowerArea => {\n    const rect = (event.target as HTMLElement).getBoundingClientRect();\n    const x = event.touches[0].clientX - rect.left;\n    const y = event.touches[0].clientY - rect.top;\n    const aspectRatio = rect.width / rect.height;\n    const breakStartY = rect.height * (1 - this.BREAK_AREA);\n    const breakStartX = rect.width * (1 - this.BREAK_AREA);\n\n    const isInBrakeZone = x > breakStartX && y > breakStartY;\n    if (isInBrakeZone) {\n      return { zone: MotorMode.brake };\n    }\n    // if (x > rect.width || x < 0 || y > rect.height || y < 0) {\n    //   return { zone: MotorMode.idle };\n    // }\n    const powerSide =\n      x / aspectRatio > y ? MotorMode.forward : MotorMode.reverse;\n\n    if (\n      current === MotorMode.forward ||\n      (current !== MotorMode.reverse && powerSide === MotorMode.forward)\n    ) {\n      // if we're in forward mode but the touch is in the reverse zone,\n      // we honor the vertical axis of the touch and keep it forward.\n      // Equivalent behavior for reverse.\n      // For going from forward to reverse, user must go through break or idle.\n      return {\n        zone: MotorMode.forward,\n        power: Math.max(0, Math.min(1, (breakStartY - y) / breakStartY)),\n      };\n    } else {\n      return {\n        zone: MotorMode.reverse,\n        power: Math.max(0, Math.min(1, (breakStartX - x) / breakStartX)),\n      };\n    }\n  };\n\n  protected onTouchMove(event: TouchEvent) {\n    const mode = this.current.mode;\n    const area = this.getTouchArea(event, mode);\n    switch (mode) {\n      case MotorMode.idle:\n        if (area.zone === MotorMode.idle) {\n          break;\n        } else if (area.zone === MotorMode.brake) {\n          this.onChange({ mode: MotorMode.brake, power: 0 });\n        } else if (area.zone === MotorMode.forward) {\n          this.onChange({ mode: MotorMode.forward, power: area.power });\n        } else if (area.zone === MotorMode.reverse) {\n          this.onChange({ mode: MotorMode.reverse, power: area.power });\n        } else {\n          throw new Error('unknown touch area for state');\n        }\n        break;\n      case MotorMode.brake:\n        if (area.zone === MotorMode.idle) {\n          this.onChange({ mode: MotorMode.idle, power: 0 });\n        } else if (area.zone === MotorMode.brake) {\n          break;\n        } else if (area.zone === MotorMode.forward) {\n          this.onChange({ mode: MotorMode.forward, power: area.power });\n        } else if (area.zone === MotorMode.reverse) {\n          this.onChange({ mode: MotorMode.reverse, power: area.power });\n        } else {\n          throw new Error('unknown touch area for state');\n        }\n        break;\n\n      case MotorMode.forward:\n        if (area.zone === MotorMode.idle) {\n          this.onChange({ mode: MotorMode.idle, power: 0 });\n        } else if (area.zone === MotorMode.brake) {\n          this.onChange({ mode: MotorMode.brake, power: 0 });\n        } else if (area.zone === MotorMode.forward) {\n          this.onChange({ mode: MotorMode.forward, power: area.power });\n        } else if (area.zone === MotorMode.reverse) {\n          break;\n        } else {\n          throw new Error('unknown touch area for state');\n        }\n        break;\n      case MotorMode.reverse:\n        if (area.zone === MotorMode.idle) {\n          this.onChange({ mode: MotorMode.idle, power: 0 });\n        } else if (area.zone === MotorMode.brake) {\n          this.onChange({ mode: MotorMode.brake, power: 0 });\n        } else if (area.zone === MotorMode.forward) {\n          break;\n        } else if (area.zone === MotorMode.reverse) {\n          this.onChange({ mode: MotorMode.reverse, power: area.power });\n        } else {\n          throw new Error('unknown touch area for state');\n        }\n        break;\n      default:\n        throw new Error('unknown power mode');\n    }\n  }\n  protected onTouchEnd() {\n    this.onChange({ mode: MotorMode.idle, power: 0 });\n  }\n  protected onTouchStart(event: TouchEvent) {\n    this.onTouchMove(event);\n  }\n  protected onChange(control: MotorControl) {\n    this.current = control;\n    this.dispatchEvent(new CustomEvent('change', { detail: control }));\n    requestAnimationFrame(this.updateCanvas.bind(this));\n  }\n\n  static styles = css`\n    :host {\n      width: 60%;\n      display: flex;\n      flex-direction: column;\n      align-items: stretch;\n      align-self: stretch;\n      -webkit-touch-callout: none;\n      -webkit-user-select: none;\n      -khtml-user-select: none;\n      -moz-user-select: none;\n      -ms-user-select: none;\n      user-select: none;\n    }\n    #canvas-container {\n      align-self: stretch;\n      height: 100%;\n    }\n  `;\n  updateCanvas(): void {\n    const canvas = this.shadowRoot!.getElementById(\n      'canvas'\n    ) as HTMLCanvasElement;\n    const width = this.canvasWidth;\n    const height = this.canvasHeight;\n    const ctx = canvas.getContext('2d')!;\n\n    const breakWidth = width * this.BREAK_AREA;\n    const breakHeight = height * this.BREAK_AREA;\n    const fwdLength = height - breakHeight;\n    const fwdThickness = breakWidth;\n    const revLength = width - breakWidth;\n    const revThickness = breakHeight;\n\n    ctx.clearRect(0, 0, width, height);\n    ctx.save();\n\n    ctx.translate(width, fwdLength);\n    ctx.rotate(Math.PI);\n    const fwdGradient = ctx.createLinearGradient(0, 0, fwdThickness, fwdLength);\n    fwdGradient.addColorStop(0, transparentColors.positive);\n    fwdGradient.addColorStop(1, translucentColors.positive);\n    ctx.fillStyle = fwdGradient;\n    ctx.fillRect(0, 0, fwdThickness, fwdLength);\n    if (this.current.mode === MotorMode.forward) {\n      ctx.fillStyle = solidColors.positive;\n      ctx.fillRect(0, 0, fwdThickness, fwdLength * this.current.power);\n    } else if (this.current.mode === MotorMode.idle) {\n      ctx.fillStyle = solidColors.positive;\n      ctx.fillRect(0, 0, fwdThickness, 4);\n    }\n    ctx.restore();\n\n    ctx.save();\n    ctx.translate(revLength, height - breakHeight);\n    ctx.rotate(Math.PI / 2);\n    const revGradient = ctx.createLinearGradient(0, 0, revThickness, revLength);\n    revGradient.addColorStop(0, transparentColors.secondary);\n    revGradient.addColorStop(1, translucentColors.secondary);\n    ctx.fillStyle = revGradient;\n    ctx.fillRect(0, 0, revThickness, revLength);\n    if (this.current.mode === MotorMode.reverse) {\n      ctx.fillStyle = solidColors.secondary;\n      ctx.fillRect(0, 0, revThickness, revLength * this.current.power);\n    }\n    ctx.restore();\n\n    ctx.save();\n    ctx.translate(width, height - breakHeight);\n    ctx.rotate(Math.PI / 2);\n    if (this.current.mode === MotorMode.brake) {\n      ctx.fillStyle = solidColors.negative;\n    } else {\n      ctx.fillStyle = translucentColors.negative;\n    }\n    ctx.fillRect(0, 0, breakHeight, breakWidth);\n    ctx.restore();\n  }\n\n  render(): TemplateResult {\n    const mode = this.current.mode;\n    const power =\n      mode === MotorMode.forward || mode === MotorMode.reverse\n        ? this.current.power\n        : 0;\n    return html`\n      <style>\n        #canvas {\n          width: '${this.canvasWidth}px';\n          height: '${this.canvasHeight}px';\n        }\n      </style>\n      <div id=\"canvas-container\">\n        <canvas\n          id=\"canvas\"\n          @touchstart=${this.onTouchStart}\n          @touchend=${this.onTouchEnd}\n          @touchmove=${this.onTouchMove}\n        ></canvas>\n      </div>\n    `;\n  }\n}\n"]}